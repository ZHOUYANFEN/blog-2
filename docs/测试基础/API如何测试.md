# API 如何测试

## API 测试的基本步骤

 主要包括以下三大步骤 ：

+ 准备测试数据：可选步骤

+ 通过API测试工具，发起对被测 API 的 request

+ 验证返回结果的 response

**常见测试工具**：

+  命令行工具 cURL 
+  图形界面工具 Postman 或者 SoapUI 
+  性能测试的 JMeter 

## 如何应对复杂场景的 API 测试

### 测试场景

#### 被测业务操作是由多个API调用协作完成

**应用场景**： 前端测试的相对不稳定性，或者由于性能测试的要求，通过模拟 API 的顺序调用来模拟测试过程 

**存在情况**：

+  后一个 API 需要使用前一个 API 返回结果 
+ 根据前一个 API 的返回结果决定后面应该调用哪个 API 

**问题**： 如何才能高效地获取单个前端操作所触发的 API 调用序列

**解决核心思路**：通过网络监控的手段，捕获单个前端操作所触发的 API 调用序列 

比如： 通过 Fiddler 之类的网络抓包工具，获取这个调用序列 

####  **API测试过程中的第三方依赖** 

**举个栗子**：

被测对象：API A

API B：在 A 内被调用，在测试环境不可用，导致 A 的测试受影响

**存在场景**：

+  单体架构下 ， 在涉及到第三方 API 集成的场景中会遇到这个问题 ， 不算严重
+  微服务架构下，API 间相互耦合的依赖问题就非常严重  

**解决思路**： 启用 Mock Server 来代替真实的 API 

**问题**： Mock Server 怎么才能真实有效地模拟被替代的 API 

**后续补充--------------------------------**

####  **异步API的测试** (难)

**概述**： 调用后会立即返回，但实际任务并没有真正完成，而是需要稍后去查询或者回调（Callback）的API 

**主要包含 2 部分**：

+  **测试异步调用是否成功** 

  相对简单， 主要检查返回值和后台工作线程是否被创建两个方面 

+  **测试异步调用的业务逻辑处理是否正确** 

   异步 API 通常发生在一些比较慢的操作上，比如数据库 I/O、消息队列 I/O 等，测试需要去验证数据库中的值、消息队列中的值等，这需要测试代码具有访问和操作数据库或者消息队列的能力 